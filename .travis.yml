# Run container based
sudo: false

language: java

jdk: oraclejdk8

# We moved up to Java 8, the matrix will be back when we build against 9
#    - oraclejdk8
#    - oraclejdk7

env:
    global:
        - DENT_TRAVIS_MVN_SETTINGS_REPO=https://github.com/deventropy/deventropy-parent.git
        # JUNIT_HELPER_COVERALLS_REPO_KEY=<secret...>
        - secure: "ljqZOiitoSOxeZQKbzVo29pXI/7AmJe8niNVTeH0Ty20HNDS03TvxQXAIuRy6Fu2+sfrj0Df6ykLT71SXhAmL/TJjo1JAv+hiV4C8e0ye7O9XvQN6ma0JR5zQZtkZNSgo+eorjLW4IZz/WnSMwXkVHR6Cmx1KnCfoLQZf3HlQ8r0b0HKq6CdG3tGy8A5TJVVMC+udeOI8exG6qRpP7SPtjrsPGMi5gs/xp9aKetO9kES+CCliKoDFTx7fRsC4/ncGn+pTSFsbmvKoVTdVGbMvialPymH59wwdK88FtlCyJHVfJUs8DiMEZI0TDoeMtQgXPMVSdVVaBCAnsONeNAJOYJN9ZMC4oKTp/0B3y9FVbwi11+O01tOQjmOFhrgWTDLDmkQmmlgUIvTZXzl48woVxUtKxqByto0WQUlYuDwXqfCY5u+gV+g33vcw3GI7VtmcFyoIov23MEyeQWEyvjIFS9bdTVQ42ce5NxwIQGOTkejLYL+fEPOX/m4jnKvGpPtsZl2fvrAx3Na6+BfjX6PU2O1c6UbCzckueGoPU33qy8jkADJ9DVFaWu/3qdxEa/gQzkpcpKDe3iPCJOj9dobilBmv65rKz5HplattvghdNrvors0w+mUPa1iZm7+aAEVGys+HJRWL6JbfITbvsdZ4he1UDcmo6+fEjWfoB4U0iA="
        # CODACY_API_TOKEN=<secret...>
        - secure: "XQGKqTxLEePISSP5ZxqbKp4HUbZmtWECYT6/lzCV/xCMZdb5xDcg66lVJ/ZGT9kPsjuXymLAtsJpVYfg45YEN3CRuTYil+/WPs4RNAIUy1/VdAOLybwxrMFWhuxR5tDVlXT6svA3OYQDF+vi6WrXaMQ8vWffTaXa3bMMw8/x5xwMzoisgm1Mv9WOqE2EEPT46L0AqSmB4q9NYqKeUe4FQL7qBSqMPzbz9Oq9S13i3/5w3nP/JBLjUdgq0no1fniy9hfN5yxiRUVtoFS4zZhLHgfslIRJs0RM1A0WSBt7z6Zfo/9c9noQl0tOnnWDH/9f4AUmSsWpFHU1z9rZfwhR55IXzKxPZkWz4RDiORi6awEjzEca5id6cX59BqcHhzrORQyY16ldpVpoTp4SVF+eICMZpGRTXA28g4oQuOLGXjQsSr6s27Rv5aiVAGJEbZp5hICDAvF+BLJP3Gkg8yPdqAbt3LfqzlSwuoxkO1Fj1vWi7zDfgoLxi/dsUo9FhrzWpaMV7mG+brZbw9pEEojXRPpgm88F3WTsvkVo9Epy1yYoBC6xrR/rD67XNgN3wXQJmfRs2O2JE9qBSkl3lWVbTJdvvjiFzZrjg/Jkbzr8sqIkOhSULV90EJNeHwweFMoXrH7oZ9Qps+kb2c+kNZHYjcB+orLSWQvahssupXoYcx0="
        # CODACY_PROJECT_TOKEN=<secret...>
        - secure: "BFw6wWwGCy4BsHEzVj5Ippmdqaq5DSko5iYdtMFuTOpM8QbKTR3zCp6/3ryI28gjW+xg4svOLH28xr/AXW6s5RcgIiAkRmtpfLMT3SP/LxkpnchUOND/tKo7KpyRKinJ1J1k5q6TOCkyv17XXs3OQdlNF1wEGgL5C4n9TgohmiaDMdBDYTkiRAjrVilm6X1EVJ3uO73Spby70b3nRtd4crjMxMwbY3aN7YML5TKWR/YYxrCsM+dyQkeT0kZpxqzTWzJ0Tkn6xyf5I7vGg3nVYHUe/mrjO9YWdpMIzSfcXoRHnK/LXOpFSyfbVoBifbF9MbJ9PE4Rh94KqSTIjTDif+aVYW4kmDL/FNVQ5OzTb2L5Ztxy4Kgt0/k5RYKGGgs6KN7Q5ksBqvSPDO27Xg0zlU61OiAc4QOEvj12Lm17IcU71uyn2mPTVWKJkk+VKPkYhQDKpn2HT5Sk9O2We2QIIzVX8t7SI7BEETpaBf3beQBk5zJWqrlp1lp5U/2B9eNeBia1x2XwbUFE/Wl9+hgNxzwraJHM7insZ3rOtYqgODL45uWNmH/qSlGAQ2wniwDdnOKeCdQY+M+/CyG+PDpc/mgPhrXuD/O1dDF0ggonp/P6gf+OFss/WEVlA9+31R0ntYG9KobuTjY0B5qTw7HiCWngCfcXw2v4gaqyHGg6xoc="
        # VERSIONEYE_REPO_KEY=<secret...>
        - secure: "XVYYDTFDS0Cp8ACag3mR0ltQR/9Vs88XGheVPYjLUy+oJcaCe1K+1RIsu4dM2R0sc97bgFpJXE5YbJn+a+/bg+XQqLLyJ6NoYfO5YZrRUxHWCPZmVQWDtpzLOLz3Orb+I2DEa5yfMEF6a8QkAkJzh/WGLhhCA+9lidG+f5n0IyZgm0Q3YfbUMw/EfQDFrjsNi/zS0yy7thKNSdQAdJ+Q7n2RzhsyV/+UXozTdIjiHj0WBx+f3NtJJbkOZZ+JYutwQl5PTa/7Jk6isSj6wG7LDzlOqmBtA4KAtrGC1tb5f0CQnu+UOhnVU4WVo6DbEoAiuMGfV988T99j2ocxHkZnzQz9UCUnWPJiYef2PyZnfT+n4YmG6vwBrIBWY1SRErv9ZQIRX4IzvqjhHo9UAE92Dez3sOwaMp6NtiaigbCcJqjvjV7Nej01DdQaZ0kAp1eeZBRHeLrBlWrl0vWoy/ATHivbreDMs23e6O/bT6aG8KiIE9jKZOgBGrnenP7Td/B3Q/f1tuW0Tri4UHHW7NbWf2GjsTxFfZKd4KMETxtLpLZrCAL3OfKhaeIo6b9nZQTbxtCQ4UDlDameMBgLHS9yG03eARNSmAFTs7Pkf8qToRFpvfP5tuN6yNedPAwJZyrukU6AHfrbX3qefeBp6r4vidyqOKOggtGIUNwHsR36GZE="

# We use JFrog OSS Repository not available in the stock Travis CI environment; so custom settings.xml
# See https://coderwall.com/p/9b_lfq/deploying-maven-artifacts-from-travis

branches:
    except:
        - travis
        - gh-pages

before_install:
    - "git clone -b travis ${DENT_TRAVIS_MVN_SETTINGS_REPO} target/travis"

install: "mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -V --settings target/travis/travis-mvn-settings.xml"

script: "mvn test -B --settings target/travis/travis-mvn-settings.xml"

after_success:
    # Coverage report to coveralls.io and codacy.com (but not for pull requests)
    - '[ "${TRAVIS_PULL_REQUEST}" = "false" ] && mvn clean test jacoco:report coveralls:report codacy:coverage'
    # Update dependencies in VersionEye
    - '[ "${TRAVIS_PULL_REQUEST}" = "false" ] && [ "${TRAVIS_BRANCH}" = "master" ] && mvn com.versioneye:versioneye-maven-plugin:update'

# Speed up builds
cache:
    directories:
        - $HOME/.m2/repository

before_cache:
    - rm -rf $HOME/.m2/repository/org/deventropy/junit-helper

# Build Notifications (and avoid emails from forks)
# Set the variable DENT_TRAVIS_NOTIFY_EMAIL in the web interface
# Pending https://github.com/travis-ci/travis-ci/issues/1094, then use ${DENT_TRAVIS_NOTIFY_EMAIL}
notifications:
  email:
    recipients:
      - deventropy-commits@lists.sourceforge.net
    on_success: always # [always|never|change] default: change
    on_failure: always # [always|never|change] default: always
