
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 21 Dec 2016
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>User Guide :: Backing up and Restoring a Database | Deventropy JUnit Helper :: Derby</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/cosmo/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="../..//css/bootswatch.css" rel="stylesheet" />
		<link href="../..//css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href="../..//css/lightbox.css" rel="stylesheet" />

		<link href="../..//css/site.css" rel="stylesheet" />
		<link href="../..//css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<link rel="author" href="http://blog.bindul.name/"/>
	</head>

	<body class="page-manual-210-backup-restore project-junit-helper-derby" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href=""><span class="color-highlight">JUnit Helper</span> Utils</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="../../../" title="Development Entropy">Development Entropy</a></li>
							<li ><a href="https://github.com/deventropy/junit-helper" title="JUnit Helper @ GitHub" class="externalLink">JUnit Helper @ GitHub</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../index.html" title="JUnit Helper :: Derby">JUnit Helper :: Derby</a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Junit Helper Derby <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../index.html" title="Home">Home</a></li>
									<li class="dropdown-submenu ">
										<a href="index.html" title="User Manual">User Manual</a>
										<ul class="dropdown-menu">
											<li ><a href="010-getting-started.html" title="Getting Started">Getting Started</a></li>
											<li ><a href="110-configuration.html" title="Configuration">Configuration</a></li>
											<li ><a href="120-datasources.html" title="Datasources">Datasources</a></li>
											<li class="active"><a href="" title="Backup and Restore">Backup and Restore</a></li>
											<li ><a href="310-concurrency.html" title="Parallel Runs">Parallel Runs</a></li>
											<li ><a href="510-utilities.html" title="Script Runner / Utilities">Script Runner / Utilities</a></li>
										</ul>
									</li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Development <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../../../development.html" title="Development Guide">Development Guide</a></li>
									<li ><a href="https://github.com/deventropy/junit-helper/issues" title="Issues" class="externalLink">Issues</a></li>
									<li ><a href="https://github.com/deventropy/junit-helper#fork-destination-box" title="Fork on GitHub" class="externalLink">Fork on GitHub</a></li>
									<li class="dropdown-submenu ">
										<a href="../../#" title="Code Quality / Continuous Integration">Code Quality / Continuous Integration</a>
										<ul class="dropdown-menu">
											<li ><a href="https://travis-ci.org/deventropy/junit-helper" title="CI - Travis" class="externalLink">CI - Travis</a></li>
											<li ><a href="https://ci.appveyor.com/project/deventropy/junit-helper" title="CI - Appveyor" class="externalLink">CI - Appveyor</a></li>
											<li ><a href="https://coveralls.io/github/deventropy/junit-helper" title="Coveralls" class="externalLink">Coveralls</a></li>
											<li ><a href="https://www.codacy.com/app/deventropy/junit-helper" title="Codacy" class="externalLink">Codacy</a></li>
											<li ><a href="https://scan.coverity.com/projects/deventropy-junit-helper" title="Coverity Scan" class="externalLink">Coverity Scan</a></li>
											<li ><a href="https://www.versioneye.com/user/projects/56b160c93d82b9003761e470" title="VersionEye" class="externalLink">VersionEye</a></li>
										</ul>
									</li>
									<li ><a href="https://dl.bintray.com/deventropy/repository" title="JFrog Bintray" class="externalLink">JFrog Bintray</a></li>
									<li ><a href="https://sourceforge.net/p/deventropy/lists/" title="Mailing Lists" class="externalLink">Mailing Lists</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="../" id="bannerLeft"><h1><span class="color-highlight">Derby</span> JUnit Helper Utils</h1></a>
					<p class="lead">Utility JUnit resource / libraries to ease DB testing with Apache Derby</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
		<div>
			<ul class="breadcrumb">
				<li><a href="../../" title="JUnit Helper">JUnit Helper</a></li>
				<li class="divider">/</li>
				<li><a href="../" title="Deventropy JUnit Helper :: Derby">Deventropy JUnit Helper :: Derby</a></li>
				<li class="divider">/</li>
				<li>User Guide :: Backing up and Restoring a Database</li>
			</ul>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<!-- Copyright 2016 Development Entropy (deventropy.org) Contributors

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. --> 
<p><a href="./index.html">↫ User Guide Home</a></p> 
<div class="page-header">
 <h1 id="user_guide__backing_up_and_restoring_a_database">User Guide :: Backing up and Restoring a Database</h1>
</div> 
<p>The Derby JUnit Helper can start a database from a backup or restore a database from a backup with or without archive logs. Creating or restoring the database from a backup is controlled through the <a href="../apidocs/org/deventropy/junithelper/derby/DerbyResourceConfig.html">DerbyResourceConfig</a> instance passed in when initializing the Derby resource.</p> 
<p>The library can also perform online backups on a database started with the <tt>EmbeddedDerbyResource</tt>. See the <a href="../apidocs/org/deventropy/junithelper/derby/EmbeddedDerbyResource.html#backupLiveDatabase-java.io.File-boolean-boolean-boolean-">backupLiveDatabase</a> Javadocs.</p> 
<p>For more information on backup and restore of Derby Instances, see the <a class="externalLink" href="http://db.apache.org/derby/docs/10.13/adminguide/cadminhubbkup98797.html">Backing up and restoring databases</a> section in the Derby Server and Administration Guide.</p> 
<div class="section"> 
 <h2 id="Online_Backup"><a name="online-backup"></a>Online Backup</h2> 
 <p>Derby supports two kinds of backups, an offline backup and an online backup. For an offline backup, ensure the Derby instance is not running and simply perform a file system copy of the Derby directory (can only be supported for a <tt>directory</tt> sub-sub protocol, as the <tt>memory</tt> database does not exist after the instance is shut down).</p> 
 <p>To perform an online backup, Derby provides System Stored Procedures to execute the operations in the <tt>SYSCS_UTIL</tt> schema. The <tt>EmbeddedDerbyResource</tt> provides convenient method to invoke the system provided procedures through the ’EmbeddedDerbyResource#backupLiveDatabase` method.</p> 
 <p>The primary parameter to the method is the <tt>backupDir</tt> directory under which backup is performed. Derby creates the backup in a child directory with the same name as the database under the directory provided.</p> 
 <p>The <tt>waitForTransactions</tt> parameter controls if the Derby system will wait for active transactions to complete before running the backup. If the parameter is set to <tt>false</tt> and there are active transactions in the instance, the backup operation will fail with a <tt>SQLException</tt>. </p> 
 <div class="section"> 
  <h3 id="Roll_Forward_Recovery">Roll Forward Recovery</h3> 
  <p>To create a backup enabling archive logging for future roll-forward recovery, set the <tt>enableArchiveLogging</tt> parameter to true. In addition the <tt>deleteArchivedLogs</tt> parameter controls if previous (prior to this backup) archive logs should be deleted or not. </p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Using_a_backup"><a name="using-backup"></a>Using a backup</h2> 
 <p>A Derby instance can be started from a backup in three different modes, as noted below. All the recovery modes listed below are mutually exclusive, and setting one in the configuration will negate all others.</p> 
 <p>These operations are not supported for Read Only (<tt>jar</tt> and <tt>classpath</tt> sub sub protocols), and though there are no explicit controls preventing the recovery modes with those sub-sub protocols; the Derby system may ignore the backup options or throw an error.</p> 
 <div class="section"> 
  <h3 id="Creating_from"><a name="create-from"></a>Creating from</h3> 
  <p>To create a database from a full backup copy at a specified location, use the <tt>DerbyResourceConfig#createDatabaseFrom</tt> configuration method with the file parameter pointing to a full backup of a database. If there is already a database with the same name in the Derby system, an error will occur and the existing database will be left intact. Internally, the <tt>EmbeddedDerbyResource</tt> uses the <tt>createFrom=path</tt> attribute in the boot-time connection URL. More information on this mode in the Derby documentation at <a class="externalLink" href="http://db.apache.org/derby/docs/10.13/adminguide/tadmincrtdbbkup.html">Creating a database from a backup copy</a>.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Restoring_to"><a name="restore-to"></a>Restoring to</h3> 
  <p>To restore a database by using a full backup from a specified location, use the <tt>DerbyResourceConfig#restoreDatabaseFrom</tt> onfiguration method with the file parameter pointing to a full backup of a database. If a database with the same name exists in the Derby system, the system will delete the database, copy it from the backup location, and then restart it. Internally, the <tt>EmbeddedDerbyResource</tt> uses the <tt>restoreFrom=path</tt> attribute in the boot-time connection URL. More information on this mode in the Derby documentation at <a class="externalLink" href="http://db.apache.org/derby/docs/10.13/adminguide/tadminhubbkup44.html">Restoring a database from a backup copy</a>.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Roll-forward_Recovery"><a name="roll-forward"></a>Roll-forward Recovery</h3> 
  <p>Derby supports roll-forward recovery to restore a damaged database to the most recent state before a failure occurred. To perform a roll-forward recovery, use the <tt>DerbyResourceConfig#recoverDatabaseFrom</tt> configuration method. Provide the location of the last good backup in the <tt>dbBackupDir</tt> parameter, and the log location in the <tt>recoveryLogDevice</tt> parameter. Note, the Derby system looks for the archive logs in a directory named <tt>logs</tt> under the <tt>recoveryLogDevice</tt> location. Internally the <tt>EmbeddedDerbyResource</tt> uses the <tt>rollForwardRecoveryFrom=path</tt> and <tt>logDevice=path</tt> attributes in the boot-time connection URL.</p> 
  <p>Derby restores a database from full backup and replays all the transactions after the backup. All the log files after a backup are required to replay the transactions after the backup. In roll-forward recovery, the log archival mode ensures that all old log files are available. The log files are available only from the time that the log archival mode is enabled.</p> 
  <p>Further reading in the Derby documentation at <a class="externalLink" href="http://db.apache.org/derby/docs/10.13/adminguide/cadminrollforward.html">Roll-forward recovery</a>.</p> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#user_guide__backing_up_and_restoring_a_database" title="User Guide :: Backing up and Restoring a Database">User Guide :: Backing up and Restoring a Database <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li class="dropdown"><a href="#Online_Backup" title="Online Backup">Online Backup <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Roll_Forward_Recovery" title="Roll Forward Recovery">Roll Forward Recovery</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li class="dropdown"><a href="#Using_a_backup" title="Using a backup">Using a backup <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Creating_from" title="Creating from">Creating from</a>
		<li><a href="#Restoring_to" title="Restoring to">Restoring to</a>
		<li><a href="#Roll-forward_Recovery" title="Roll-forward Recovery">Roll-forward Recovery</a>
				<li class="divider"></li>
			</ul>
		</li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../../" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/deventropy/junit-helper" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li class="nav-header">Junit Helper Derby</li>
						<li >
							<a href="../index.html" title="Home">Home</a>
						</li>
						<li >
							<a href="index.html" title="User Manual">User Manual <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li >
							<a href="010-getting-started.html" title="Getting Started">Getting Started</a>
						</li>
						<li >
							<a href="110-configuration.html" title="Configuration">Configuration</a>
						</li>
						<li >
							<a href="120-datasources.html" title="Datasources">Datasources</a>
						</li>
						<li class="active">
							<a href="#" title="Backup and Restore">Backup and Restore</a>
						</li>
						<li >
							<a href="310-concurrency.html" title="Parallel Runs">Parallel Runs</a>
						</li>
						<li >
							<a href="510-utilities.html" title="Script Runner / Utilities">Script Runner / Utilities</a>
						</li>
							</ul>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Modules</li>
						<li >
							<a href="../index.html" title="JUnit Helper :: Derby">JUnit Helper :: Derby</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../../../development.html" title="Development Guide">Development Guide</a>
						</li>
						<li >
							<a href="https://github.com/deventropy/junit-helper/issues" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/deventropy/junit-helper#fork-destination-box" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
						<li >
							<a href="../../#" title="Code Quality / Continuous Integration">Code Quality / Continuous Integration <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li >
							<a href="https://travis-ci.org/deventropy/junit-helper" title="CI - Travis" class="externalLink">CI - Travis</a>
						</li>
						<li >
							<a href="https://ci.appveyor.com/project/deventropy/junit-helper" title="CI - Appveyor" class="externalLink">CI - Appveyor</a>
						</li>
						<li >
							<a href="https://coveralls.io/github/deventropy/junit-helper" title="Coveralls" class="externalLink">Coveralls</a>
						</li>
						<li >
							<a href="https://www.codacy.com/app/deventropy/junit-helper" title="Codacy" class="externalLink">Codacy</a>
						</li>
						<li >
							<a href="https://scan.coverity.com/projects/deventropy-junit-helper" title="Coverity Scan" class="externalLink">Coverity Scan</a>
						</li>
						<li >
							<a href="https://www.versioneye.com/user/projects/56b160c93d82b9003761e470" title="VersionEye" class="externalLink">VersionEye</a>
						</li>
							</ul>
						</li>
						<li >
							<a href="https://dl.bintray.com/deventropy/repository" title="JFrog Bintray" class="externalLink">JFrog Bintray</a>
						</li>
						<li >
							<a href="https://sourceforge.net/p/deventropy/lists/" title="Mailing Lists" class="externalLink">Mailing Lists</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Legal</li>
						<li >
							<a href="../../license.html" title="License">License</a>
						</li>
						<li >
							<a href="../../../privacy.html" title="Privacy Policy">Privacy Policy</a>
						</li>
						<li class="nav-header">Maven documentation</li>
						<li >
							<a href="../project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="../project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote><span class="color-highlight">JUnit Helper</span> Utils is a collection of (mostly) External Resources
		          built for <a href="http://junit.org/" title="JUnit">JUnit</a>. They aid in developing test cases using
		          external resources, like databases, HTTP servers, etc.</blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2015-2016 <a href="http://www.deventropy.org/">Development Entropy Projects</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 1.0-alpha.1-SNAPSHOT. </span><span class="publishDate">Last Published: 21 Dec 2016. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="../..//js/lightbox.min.js"></script>
	<script src="../..//js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="../..//js/reflow-skin.js"></script>

	</body>
</html>
