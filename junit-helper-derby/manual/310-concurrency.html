
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 21 Dec 2016
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>User Guide :: Managing Concurrency | Deventropy JUnit Helper :: Derby</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/cosmo/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="../..//css/bootswatch.css" rel="stylesheet" />
		<link href="../..//css/reflow-skin.css" rel="stylesheet" />

		<link href="http://yandex.st/highlightjs/7.5/styles/github.min.css" rel="stylesheet" />

		<link href="../..//css/lightbox.css" rel="stylesheet" />

		<link href="../..//css/site.css" rel="stylesheet" />
		<link href="../..//css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->


		
<link rel="author" href="http://blog.bindul.name/"/>
	</head>

	<body class="page-manual-310-concurrency project-junit-helper-derby" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href=""><span class="color-highlight">JUnit Helper</span> Utils</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li ><a href="../../../" title="Development Entropy">Development Entropy</a></li>
							<li ><a href="https://github.com/deventropy/junit-helper" title="JUnit Helper @ GitHub" class="externalLink">JUnit Helper @ GitHub</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../index.html" title="JUnit Helper :: Derby">JUnit Helper :: Derby</a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Junit Helper Derby <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../index.html" title="Home">Home</a></li>
									<li class="dropdown-submenu ">
										<a href="index.html" title="User Manual">User Manual</a>
										<ul class="dropdown-menu">
											<li ><a href="010-getting-started.html" title="Getting Started">Getting Started</a></li>
											<li ><a href="110-configuration.html" title="Configuration">Configuration</a></li>
											<li ><a href="120-datasources.html" title="Datasources">Datasources</a></li>
											<li ><a href="210-backup-restore.html" title="Backup and Restore">Backup and Restore</a></li>
											<li class="active"><a href="" title="Parallel Runs">Parallel Runs</a></li>
											<li ><a href="510-utilities.html" title="Script Runner / Utilities">Script Runner / Utilities</a></li>
										</ul>
									</li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Development <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li ><a href="../../../development.html" title="Development Guide">Development Guide</a></li>
									<li ><a href="https://github.com/deventropy/junit-helper/issues" title="Issues" class="externalLink">Issues</a></li>
									<li ><a href="https://github.com/deventropy/junit-helper#fork-destination-box" title="Fork on GitHub" class="externalLink">Fork on GitHub</a></li>
									<li class="dropdown-submenu ">
										<a href="../../#" title="Code Quality / Continuous Integration">Code Quality / Continuous Integration</a>
										<ul class="dropdown-menu">
											<li ><a href="https://travis-ci.org/deventropy/junit-helper" title="CI - Travis" class="externalLink">CI - Travis</a></li>
											<li ><a href="https://ci.appveyor.com/project/deventropy/junit-helper" title="CI - Appveyor" class="externalLink">CI - Appveyor</a></li>
											<li ><a href="https://coveralls.io/github/deventropy/junit-helper" title="Coveralls" class="externalLink">Coveralls</a></li>
											<li ><a href="https://www.codacy.com/app/deventropy/junit-helper" title="Codacy" class="externalLink">Codacy</a></li>
											<li ><a href="https://scan.coverity.com/projects/deventropy-junit-helper" title="Coverity Scan" class="externalLink">Coverity Scan</a></li>
											<li ><a href="https://www.versioneye.com/user/projects/56b160c93d82b9003761e470" title="VersionEye" class="externalLink">VersionEye</a></li>
										</ul>
									</li>
									<li ><a href="https://dl.bintray.com/deventropy/repository" title="JFrog Bintray" class="externalLink">JFrog Bintray</a></li>
									<li ><a href="https://sourceforge.net/p/deventropy/lists/" title="Mailing Lists" class="externalLink">Mailing Lists</a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
	<div class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="../" id="bannerLeft"><h1><span class="color-highlight">Derby</span> JUnit Helper Utils</h1></a>
					<p class="lead">Utility JUnit resource / libraries to ease DB testing with Apache Derby</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
	</div>
		<div>
			<ul class="breadcrumb">
				<li><a href="../../" title="JUnit Helper">JUnit Helper</a></li>
				<li class="divider">/</li>
				<li><a href="../" title="Deventropy JUnit Helper :: Derby">Deventropy JUnit Helper :: Derby</a></li>
				<li class="divider">/</li>
				<li>User Guide :: Managing Concurrency</li>
			</ul>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span8">
			<div class="body-content">
<!-- Copyright 2016 Development Entropy (deventropy.org) Contributors

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. --> 
<p><a href="./index.html">â†« User Guide Home</a></p> 
<div class="page-header">
 <h1 id="user_guide__managing_concurrency">User Guide :: Managing Concurrency</h1>
</div> 
<p>While a running instance of Derby is perfectly happy to support multiple concurrent consumers; it does not like running multiple instances of Derby in a single JVM (see Derby System documentation <a class="externalLink" href="https://db.apache.org/derby/docs/10.13/devguide/cdevdvlp96597.html">One Derby instance for each Java Virtual Machine (JVM)</a>. This makes sharing a Derby instance across multiple instances a little challenging.</p> 
<p>So, first if multiple test classes are required to use this library or Derby instances in general every attempt should be made to consolidate the test cases in a single class.</p> 
<div class="section"> 
 <h2 id="Single_Derby_Instance_per_Test_Class">Single Derby Instance per Test Class</h2> 
 <p>The first strategy is to use a single instance of Derby per class. This can be ensured managing the <tt>EmbeddedDerbyResource</tt> as a <tt>@ClassRule</tt> or using <tt>@BeforeClass</tt> / <tt>@AfterClass</tt> methods.</p> 
 <p>Further, if using a test runner like Maven Surefire, class and method level parallelism should be disabled, at least for these classes. See <a class="externalLink" href="https://maven.apache.org/surefire/maven-surefire-plugin/examples/fork-options-and-parallel-execution.html">Fork Options and Parallel Test Execution</a> for information on Surefire parallelism.</p> 
 <p>Different classes using different Derby database homes can however be executed on multiple JVMs in parallel, so any test runner supporting <b>forked JVMs</b> (like Surefire) may be used to executed individual classes on multiple JVMs.</p> 
 <div class="section"> 
  <h3 id="Class_Cleanup">Class Cleanup</h3> 
  <p>If multiple test classes executed sequentially in a JVM need to initialize a new instance of Derby (after a previous run by the same/different class started, then stopped a Derby instance) may run into issues unless the previous instance was shut down properly (see <a class="externalLink" href="https://db.apache.org/derby/docs/10.13/devguide/tdevdvlp20349.html">Shutting down the system</a> in the Derby Developer Guide.</p> 
  <p>It is therefore important to <i>clean up after oneself</i>. The <tt>DerbyUtil</tt> class in this library provides a convenient method to achieve that: <tt>#shutdownDerbySystemQuitely(boolean)</tt>. This may be wired up in a method that is executed at the end of running all tests in the method. An example:</p> 
  <div class="source"> 
   <div class="source"> 
    <pre>@AfterClass
public static void cleanupDerbySystem () {
	// Cleanup for next test
	DerbyUtils.shutdownDerbySystemQuitely(true);
}
</pre> 
   </div> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Multiple_Derby_Instances_per_Test_Class__Method">Multiple Derby Instances per Test Class / Method</h2> 
 <p>In cases where it is absolutely necessary, it is possible to use multiple Derby instances in a single test class or method. There are a few caveats though:</p> 
 <ul> 
  <li>Only a single instance of Derby should be active at any time.</li> 
  <li>Unless there is a single test concurrency; the initialization and shutdown of Derby instances or <tt>EmbeddedDerbyResource</tt> should be controlled by a single test method or thread.</li> 
 </ul> 
 <p>A sample flow case for this behavior is shown below:</p> 
 <div class="source"> 
  <div class="source"> 
   <pre>	// Set up and start the first instance
	final DerbyResourceConfig derbyResourceConfig1 = DerbyResourceConfig.buildDefault();	// Add other setup
	final EmbeddedDerbyResource embeddedDerbyResource1 = new EmbeddedDerbyResource(derbyResourceConfig1,
			derbySystemHomeDir);
	embeddedDerbyResource1.start();
	
	// Execute test steps with the first database
	
	// Shutdown and clean up the first instance
	embeddedDerbyResource1.close();
	DerbyUtils.shutdownDerbySystemQuitely(true);
	
	// Set up and start the second instance
	final DerbyResourceConfig derbyResourceConfig2 = DerbyResourceConfig.buildDefault();	// Add other setup
	final EmbeddedDerbyResource embeddedDerbyResource2 = new EmbeddedDerbyResource(derbyResourceConfig2,
			derbySystemHomeDir);
	embeddedDerbyResource2.start();
	
	// Execute test steps with the second database
	
	// Shutdown and clean up the second instance
	embeddedDerbyResource2.close();
	DerbyUtils.shutdownDerbySystemQuitely(true);
</pre> 
  </div> 
 </div> 
</div>
			</div>
		</div>
		<div class="span4">
			<div id="toc-sidebar">
				<div class="well">
					<ul class="nav nav-list">
						<li class="nav-header">Table of Contents</li>
		<li class="dropdown"><a href="#user_guide__managing_concurrency" title="User Guide :: Managing Concurrency">User Guide :: Managing Concurrency <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li class="dropdown"><a href="#Single_Derby_Instance_per_Test_Class" title="Single Derby Instance per Test Class">Single Derby Instance per Test Class <b class="caret"></b></a>
			<ul class="nav nav-list">
		<li><a href="#Class_Cleanup" title="Class Cleanup">Class Cleanup</a>
				<li class="divider"></li>
			</ul>
		</li>
		<li><a href="#Multiple_Derby_Instances_per_Test_Class__Method" title="Multiple Derby Instances per Test Class / Method">Multiple Derby Instances per Test Class / Method</a>
				<li class="divider"></li>
			</ul>
		</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li >
							<a href="../../" title="Home">Home</a>
						</li>
						<li >
							<a href="https://github.com/deventropy/junit-helper" title="GitHub project" class="externalLink">GitHub project</a>
						</li>
						<li class="nav-header">Junit Helper Derby</li>
						<li >
							<a href="../index.html" title="Home">Home</a>
						</li>
						<li >
							<a href="index.html" title="User Manual">User Manual <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li >
							<a href="010-getting-started.html" title="Getting Started">Getting Started</a>
						</li>
						<li >
							<a href="110-configuration.html" title="Configuration">Configuration</a>
						</li>
						<li >
							<a href="120-datasources.html" title="Datasources">Datasources</a>
						</li>
						<li >
							<a href="210-backup-restore.html" title="Backup and Restore">Backup and Restore</a>
						</li>
						<li class="active">
							<a href="#" title="Parallel Runs">Parallel Runs</a>
						</li>
						<li >
							<a href="510-utilities.html" title="Script Runner / Utilities">Script Runner / Utilities</a>
						</li>
							</ul>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Modules</li>
						<li >
							<a href="../index.html" title="JUnit Helper :: Derby">JUnit Helper :: Derby</a>
						</li>
						<li class="nav-header">Development</li>
						<li >
							<a href="../../../development.html" title="Development Guide">Development Guide</a>
						</li>
						<li >
							<a href="https://github.com/deventropy/junit-helper/issues" title="Issues" class="externalLink">Issues</a>
						</li>
						<li >
							<a href="https://github.com/deventropy/junit-helper#fork-destination-box" title="Fork on GitHub" class="externalLink">Fork on GitHub</a>
						</li>
						<li >
							<a href="../../#" title="Code Quality / Continuous Integration">Code Quality / Continuous Integration <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li >
							<a href="https://travis-ci.org/deventropy/junit-helper" title="CI - Travis" class="externalLink">CI - Travis</a>
						</li>
						<li >
							<a href="https://ci.appveyor.com/project/deventropy/junit-helper" title="CI - Appveyor" class="externalLink">CI - Appveyor</a>
						</li>
						<li >
							<a href="https://coveralls.io/github/deventropy/junit-helper" title="Coveralls" class="externalLink">Coveralls</a>
						</li>
						<li >
							<a href="https://www.codacy.com/app/deventropy/junit-helper" title="Codacy" class="externalLink">Codacy</a>
						</li>
						<li >
							<a href="https://scan.coverity.com/projects/deventropy-junit-helper" title="Coverity Scan" class="externalLink">Coverity Scan</a>
						</li>
						<li >
							<a href="https://www.versioneye.com/user/projects/56b160c93d82b9003761e470" title="VersionEye" class="externalLink">VersionEye</a>
						</li>
							</ul>
						</li>
						<li >
							<a href="https://dl.bintray.com/deventropy/repository" title="JFrog Bintray" class="externalLink">JFrog Bintray</a>
						</li>
						<li >
							<a href="https://sourceforge.net/p/deventropy/lists/" title="Mailing Lists" class="externalLink">Mailing Lists</a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Legal</li>
						<li >
							<a href="../../license.html" title="License">License</a>
						</li>
						<li >
							<a href="../../../privacy.html" title="Privacy Policy">Privacy Policy</a>
						</li>
						<li class="nav-header">Maven documentation</li>
						<li >
							<a href="../project-info.html" title="Project Information">Project Information <i class="icon-chevron-right"></i></a>
						</li>
						<li >
							<a href="../project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote><span class="color-highlight">JUnit Helper</span> Utils is a collection of (mostly) External Resources
		          built for <a href="http://junit.org/" title="JUnit">JUnit</a>. They aid in developing test cases using
		          external resources, like databases, HTTP servers, etc.</blockquote>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2015-2016 <a href="http://www.deventropy.org/">Development Entropy Projects</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 1.0-alpha.1-SNAPSHOT. </span><span class="publishDate">Last Published: 21 Dec 2016. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="../..//js/lightbox.min.js"></script>
	<script src="../..//js/reflow-scroll.js"></script>
	<script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>

	<script src="../..//js/reflow-skin.js"></script>

	</body>
</html>
